// Variables
def currentDate = new Date()
def timestamp = currentDate.format("yyyyMMddHHmmss")

params {
    year          = currentDate.format("yyyy")
    month         = currentDate.format("MM")
    day         = currentDate.format("DD")
    runid         = "run-${year}${month}${day}"

    chunk_size = 200
    rand_fraction = 0.001
    maf_interval = "(0.05, 0.5]"
    reads = "s3://1000genomes/release/20130502/ALL.*.vcf.gz"
    panel = "s3://1000genomes/release/20130502/integrated_call_samples_v3.20130502.ALL.panel"
    results  = "s3://1000genome-d0aqs32v/1000genomes/results/${runid}"
}

profiles {

    awsbatch {
        aws.region = 'us-east-1'
        wave.enabled = false

        process {
		queue = 'fargate_job_queue'
		executor = 'awsbatch'
		withLabel: pca {
			container = 'job-definition://arn:aws:batch:us-east-1:041314368896:job-definition/fargate-job-pca:2'
			cpus = 1
        		memory = 1.GB
		}
		withLabel: bcftool {
			cpus = 2
        		memory = 4.GB
		}
	}


    }
    
    'local_a' {
        process.container = "docker://staphb/bcftools:1.21"
	//process.container = 'job-definition://arn:aws:batch:us-east-1:041314368896:job-definition/fargate-job-bcftool:2'
        process.time = '90 min'
    }

} 


trace {
    enabled = true
    file = "${params.results}/trace.txt"
    fields = 'task_id,name,status,exit,realtime,%cpu,rss'
    overwrite = true
}

timeline {
    enabled = true
    file = "${params.results}/timeline.html"
    overwrite = true
}
